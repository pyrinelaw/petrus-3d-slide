(function(){var getFirstTouchEventPos=function(e,orientation){var touches=e.touches,changedTouches=e.changedTouches,touchVo=null;if(changedTouches&&changedTouches.length>0){touchVo=changedTouches[0]}else if(touches&&touches.length>0){touchVo=touches[0]}if(touchVo){return touchVo['client'+orientation.toLocaleUpperCase()]||touchVo['page'+orientation.toLocaleUpperCase()]}return NaN}var defaultOptions={orientation:'y',$el:null,perspective:NaN,speed:0.5,callbacks:{show:null,hide:null,init:null}}var resetOptions={valid:false,allow:true,startPos:NaN,movePos:NaN,endPos:NaN}var create$selection=function(idx,orientation){var $selection=$('<section></section>');var styleClass='peturs-3d-slide-section-'+orientation+'-'+idx;$selection.addClass(styleClass);return $selection}var Attrs={initialize:function(){var options=this.options,$el=options.$el,orientation=options.orientation;options.perspective=options.perspective||3;options.$children=[];var $children=$el.children();if($children.length<2)return false;$el.addClass('peturs-3d-slide-container');$el.attr('ondragstart','return false');var $wrap=$("<div class='peturs-3d-slide-wrap'></div>");options.$children=$children;$children.remove();var $sections=[];$sections[0]=create$selection(0,orientation);$sections[1]=create$selection(1,orientation);$sections[2]=create$selection(2,orientation);$el.prepend($wrap);$sections[1].append(options.$children[0]);$wrap.append($sections[0]);$wrap.append($sections[1]);$wrap.append($sections[2]);options.$wrap=$wrap;options.$sections=$sections;if(options.callbacks.init){options.callbacks.init()}return true},slideStart:function(e){var options=this.options;if(!options.allow)return;if(options.valid)return;var orientation=options.orientation,pos=NaN,$children=options.$children;pos=e==null?options.startPos:getFirstTouchEventPos(e,orientation);if(pos==NaN)return;options.startPos=pos;var $el=options.$el,$wrap=options.$wrap,$sections=options.$sections,perspective=options.perspective,idx=options.idx,$children=options.$children,prevChild=this.getPrevChild(),nextChild=this.getNextChild();var perspective=orientation=='y'?($el.height()*perspective):($el.width()*perspective);$wrap.css('perspective',perspective);$children.each(function(i,ele){if(idx==i){$(ele).removeClass('peturs-3d-slide-hide')}else{$(ele).addClass('peturs-3d-slide-hide')}});$(prevChild).removeClass('peturs-3d-slide-hide');$(nextChild).removeClass('peturs-3d-slide-hide');$sections[0].css('opacity',0);$sections[2].css('opacity',0);$sections[0].append(prevChild);$sections[2].append(nextChild);options.valid=true},slideMove:function(e){var options=this.options;if(!options.allow)return;if(!options.valid)return;if(e.preventDefault)e.preventDefault();var orientation=options.orientation;pos=NaN;pos=getFirstTouchEventPos(e,orientation);if(pos!=NaN)options.movePos=pos;if(options.$children.length==2){var cell=pos-options.startPos,$sections=options.$sections;if(cell<0){$sections[2].append($sections[0].children())}else{$sections[0].append($sections[2].children())}}this.set3D()},slideEnd:function(e){var options=this.options;if(!options.allow)return;var orientation=options.orientation;pos=NaN;pos=e==null?options.endPos:getFirstTouchEventPos(e,orientation);options.endPos=pos;options.allow=false;var $el=options.$el,cell=pos-options.startPos,cell=(pos-options.startPos),dis=(orientation=='y'?$el.height():$el.width()),percent=cell/dis,$sections=options.$sections,speed=options.speed*(1-percent),_this=this;if(!cell){options.valid=false;options.allow=true;return}if(orientation=='y'){if(cell<0){$sections[1].css({'transition':('all '+speed+'s')});$sections[1].css({opacity:0,'transform':'translate(0%, -100%) rotateX(90deg)'});$sections[2].css({'transition':('all '+speed+'s')});$sections[2].css({opacity:1,'transform':'translate(0%, 0%) rotateX(0deg)'})}else{$sections[1].css({'transition':('all '+speed+'s')});$sections[1].css({opacity:0,'transform':'translate(0%, 100%) rotateX(-90deg)'});$sections[0].css({'transition':('all '+speed+'s')});$sections[0].css({opacity:1,'transform':'translate(0%, 0%) rotateX(0deg)'})}}else{if(cell<0){$sections[1].css({'transition':('all '+speed+'s')});$sections[1].css({opacity:0,'transform':'translate(-100%, 0%) rotateY(-90deg)'});$sections[2].css({'transition':('all '+speed+'s')});$sections[2].css({opacity:1,'transform':'translate(0%, 0%) rotateY(0deg)'})}else{$sections[1].css({'transition':('all '+speed+'s')});$sections[1].css({opacity:0,'transform':'translate(100%, 0%) rotateY(90deg)'});$sections[0].css({'transition':('all '+speed+'s')});$sections[0].css({opacity:1,'transform':'translate(0%, 0%) rotateY(0deg)'})}}var _this=this;setTimeout(function(){_this.endReset3DSlide()},speed*1000)},getNextAcIdx:function(isPrev){var idx=this.options.idx,len=this.options.$children.length;if(isPrev){return idx>0?(idx-1):(len-1)}else{return idx<(len-1)?(idx+1):0}},getPrevChild:function(){return this.options.$children[this.getNextAcIdx(true)]},getNextChild:function(){return this.options.$children[this.getNextAcIdx()]},get3DDisPercent:function(deg){var _deg=Math.abs(deg);if(_deg==90)return 0;if(_deg==0)return 100;var percent=(90-_deg)/90*100;return percent},set3D:function(){var options=this.options,$el=options.$el,idx=options.idx,orientation=options.orientation,cell=(options.movePos-options.startPos),dis=(orientation=='y'?$el.height():$el.width()),percent=cell/dis,$sections=options.$sections,deg=_deg=0,rotate=_rorate=0,_dis=0,translate=_translate=0,translatePercent=0,_opacity=Math.abs(percent),opacity=1-_opacity;if(orientation=='y'){if(percent<=0){_deg=(-90-90*percent);deg=90-Math.abs(_deg);translatePercent=this.get3DDisPercent(_deg);translate=0-translatePercent;_translate=100-translatePercent;$sections[1].css({opacity:opacity,'transform-origin':'50% 100% 0px','transform':'translate(0%, '+translate+'%) rotateX('+deg+'deg)'});$sections[2].css({opacity:_opacity,'transform':'translate(0%, '+_translate+'%) rotateX('+_deg+'deg)'})}else{_deg=90-(90*percent);deg=0-(90-_deg);translatePercent=this.get3DDisPercent(_deg,orientation);translate=translatePercent;_translate=-100+translatePercent;$sections[1].css({opacity:opacity,'transform-origin':'50% 0% 0px','transform':'translate(0%, '+translate+'%) rotateX('+deg+'deg)'});$sections[0].css({opacity:_opacity,'transform':'translate(0%, '+_translate+'%) rotateX('+_deg+'deg)'})}}else{if(percent<=0){_deg=90+(90*percent);deg=0-(90-_deg);translatePercent=this.get3DDisPercent(_deg,orientation);translate=0-translatePercent;_translate=100-translatePercent;$sections[1].css({opacity:opacity,'transform-origin':'100% 50% 0px','transform':'translate('+translate+'%, 0%) rotateY('+deg+'deg)'});$sections[2].css({opacity:_opacity,'transform':'translate('+_translate+'%, 0%) rotateY('+_deg+'deg)'})}else{_deg=-90+(90*percent);deg=90-(0-_deg);translatePercent=this.get3DDisPercent(_deg,orientation);translate=translatePercent;_translate=-100+translatePercent;$sections[1].css({opacity:opacity,'transform-origin':'0% 50% 0px','transform':'translate('+translate+'%, 0%) rotateY('+deg+'deg)'});$sections[0].css({opacity:_opacity,'transform':'translate('+_translate+'%, 0%) rotateY('+_deg+'deg)'})}}},endReset3DSlide:function(){var options=this.options,$wrap=options.$wrap,$sections=options.$sections,_$sections=[],idx=options.idx,orientation=options.orientation,cell=(options.endPos-options.startPos);for(var i=0;i<3;i++){$sections[i].removeClass('peturs-3d-slide-section-'+orientation+'-'+i);$sections[i].css({'opacity':'','transform':'','transition':'','transform-origin':''})}if(cell<=0){$wrap.append($sections[0])}else{$wrap.prepend($sections[2])}$sections=[];var $wrapChildren=$wrap.children();$wrapChildren.each(function(i,ele){$sections[i]=$(ele);$sections[i].addClass('peturs-3d-slide-section-'+orientation+'-'+i)});$sections[0].css('opacity',0);$sections[2].css('opacity',0);options.$sections=$sections;if(options.callbacks.show){options.callbacks.hide.call(null,options.idx,options.$children[options.idx])}options.idx=this.getNextAcIdx(cell<0?false:true);if(options.callbacks.show){options.callbacks.show.call(null,options.idx,options.$children[options.idx])}$.extend(true,options,resetOptions)},prev:function(){var options=this.options;if(!options.allow)return;options.startPos=1;options.endPos=2;this.slideStart(null);this.slideEnd(null)},next:function(){var options=this.options;if(!options.allow)return;options.startPos=2;options.endPos=1;this.slideStart(null);this.slideEnd(null)}}var slide3D=function(settings){settings=settings||{};var options=this.options={};$.extend(true,options,resetOptions,defaultOptions,settings);this.options=options;var $el=this.$el=options.$el,idx=options.idx=0;$.extend(true,this,Attrs);var initResult=this.initialize();if(!initResult)return;var _this=this;$el[0].addEventListener('touchstart',function(e){_this.slideStart(e)},false);document.addEventListener('touchmove',function(e){_this.slideMove(e)},false);document.addEventListener('touchend',function(e){_this.slideEnd(e)},false);return this}var petrus_3d_slide=function(settings){var slide=new slide3D(settings);return{prev:function(){slide.prev()},next:function(){slide.next()}}}var custom=1;$.petrus_3d_slide=function(settings){settings.custom=custom;custom++;return new petrus_3d_slide(settings)}$.fn.petrus_3d_slide=function(settings){settings=settings||{};settings.$el=$(this);return petrus_3d_slide(settings)}})()